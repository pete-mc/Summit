<body>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript">
        document.addEventListener('deviceready', function() {
            var ref = cordova.InAppBrowser.open('https://terrain.scouts.com.au', '_blank', 'location=yes');

            ref.addEventListener('loadstop', function(event) {
                if (event.url.startsWith('https://terrain.scouts.com.au')) {
                    ref.executeScript({
                        code: `
                            console.log = function(message) {
                                window.postMessage(message, '*');
                            };
                        `
                    });

                    // JavaScript files to inject
                    var jsFiles = [
                        "/bin/summit.js"
                    ];

                    // CSS files to inject
                    var cssFiles = [
                        "/styles/dependencies/datatables.min.css",
                        "/styles/dependencies/flatpickr.min.css",
                        "/styles/summit.css"
                    ];

                    jsFiles.forEach(function(jsFile) {
                        fetch(jsFile)
                            .then(response => response.text())
                            .then(js => {
                                ref.executeScript({ code: js });
                            })
                            .catch(error => console.error('Error injecting JS file:', error));
                    });

                    cssFiles.forEach(function(cssFile) {
                        fetch(cssFile)
                            .then(response => response.text())
                            .then(css => {
                                ref.insertCSS({ code: css });
                            })
                            .catch(error => console.error('Error injecting CSS file:', error));
                    });
                }
            });

            ref.addEventListener('loaderror', function(event) {
                console.error('Load error: ' + event.message);
            });
        });

        window.addEventListener('message', function(event) {
            console.log('Received message: ' + event.data);
        });
    </script>
</body>