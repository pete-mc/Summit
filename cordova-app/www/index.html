<body>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript">
        document.addEventListener('deviceready', function() {
            var ref = cordova.InAppBrowser.open('https://terrain.scouts.com.au', '_blank', 'location=yes');
            console.log("deviceready");
            ref.addEventListener('loadstop', async function(event) {
                console.log("loadstop");
                var url = new URL(event.url);
                console.log(url.origin + url.pathname);
                if (url.origin === 'https://terrain.scouts.com.au' && url.pathname !== '/') {
                    console.log("Loading Summit");
                    // JavaScript files to inject
                    var jsFiles = [
                        "bin/summit.js"
                    ];

                    // CSS files to inject
                    var cssFiles = [
                        "styles/dependencies/datatables.min.css",
                        "styles/dependencies/flatpickr.min.css",
                        "styles/summit.css"
                    ];
                    console.log("Loading JS Files");
                    for (let jsFile of jsFiles) {
                        await fetch(jsFile)
                            .then(response => response.text())
                            .then(js => {
                                js += `\n//# sourceURL=${jsFile}`;
                                return ref.executeScript({ code: js });
                            })
                            .catch(error => console.log('Error injecting JS file:', error));
                    }
                    console.log("Loading CSS Files");
                    for (let cssFile of cssFiles) {
                        await fetch(cssFile)
                            .then(response => response.text())
                            .then(css => ref.insertCSS({ code: css }))
                            .catch(error => console.log('Error injecting CSS file:', error));
                    }
                    console.log("Loaded Summit, Launching now");
                }
            });

            ref.addEventListener('loaderror', function(event) {
                console.log('Load error: ' + event.message);
            });
        });
    </script>
</body>